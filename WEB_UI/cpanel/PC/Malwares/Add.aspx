<%@ Page Title="" Language="C#" MasterPageFile="~/cpanel/PC/MasterPage/ControPanel.master" AutoEventWireup="true" CodeFile="Add.aspx.cs" Inherits="cpanel_PC_Administrative_Tools_Add" %>

<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="Server">
    <style>
        input[readonly] {
            background-color: white;
        }
    </style>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

    <script>


        function Run() {
            document.getElementById("<%=SendA.ClientID%>").value = get_selected_catogires();
            document.getElementById('<%= btnSave.ClientID %>').click();
        }
        function upload_zip() {
            var formData = new FormData();
            formData.append('malware_name', document.getElementById('name').value);
            formData.append('malware_description', document.getElementById('description').value);
            formData.append('malware_exe', document.getElementById('file_malware_exe').files[0]);
            formData.append('malware_csv', document.getElementById('file_malware_csv').files[0]);
            formData.append('malware_json', document.getElementById('file_malware_json').files[0]);
            formData.append('publisher_key', 'key');
            var $progress = $('.progress');
            var $progressBar = $('.progress-bar');
            $.ajax({
                url: '<%=System.Configuration.ConfigurationManager.AppSettings["CNC_File_UPLOADER"]%>',
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,

                xhr: function () {
                    var xhr = new XMLHttpRequest();
                    xhr.upload.onprogress = function (e) {
                        var percent = '0';
                        var percentage = '0%';

                        if (e.lengthComputable) {
                            percent = Math.round((e.loaded / e.total) * 100);
                            percentage = percent + '%';
                            $progressBar.width(percentage).attr('aria-valuenow', percent).text(percentage);
                        }
                    };

                    return xhr;
                },
                success: function (data) {

                    //console.log(data);
                    Swal.fire({
                        icon: 'success',
                        title: 'Your work has been saved',
                        showConfirmButton: true,
                        preConfirm: () => {
                            window.location.replace("Default.aspx");
                            return true;
                        }
                    });

                },

                error: function () {
                    console.log('error');
                     Swal.fire(
                        'Something wrong !',
                        'Server is not reachable !',
                        'error'
                    )
                },

                complete: function () {
                    console.log('complete');
                },
            });

        }
    </script>
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="ContentPlaceHolder_main" runat="Server">
    <asp:HiddenField ID="SendA" runat="server" />
    <h2 style="display: inline; padding-left: 20px;">Add new malware :</h2>
    <hr />
    <a href="Default.aspx" class="btn btn-success"><span>↩ Back</span></a>

    <div style="padding-left: 30px; padding-top: 20px;">
        <table style="width: 500px;" align="Left">
            <tr>
                <td style="width: 400px;">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Malware name:</span>
                        </div>
                        <input type="Text" id="name" class="form-control" placeholder="title" style="text-align: center;" required>
                    </div>
                </td>
            </tr>
            <tr>
                <td style="width: 400px;">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Description:</span>
                        </div>
                        <textarea id="description" cols="20" rows="5" style="width: 350px;"></textarea>
                    </div>
                </td>
            </tr>
            <tr>
                <td style="width: 400px;">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Malware(.exe):</span>
                        </div>
                        <input id="file_malware_exe" type="file" class="btn btn-info" accept=".exe" required="required" />
                    </div>
                </td>
            </tr>

            <tr>
                <td style="width: 500px;">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Malware(.csv):</span>
                        </div>
                        <input id="file_malware_csv" type="file" class="btn btn-info" accept=".csv" required="required" />
                    </div>
                </td>
            </tr>
            <tr>
                <td style="width: 500px;">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Malware(.json):</span>
                        </div>
                        <input id="file_malware_json" type="file" class="btn btn-info" accept=".json" required="required" />
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="progress" style="height: 30px;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated " style="height: 30px;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td style="text-align: right">
                    <input type="button" class="btn btn-md btn-success" onclick="upload_zip()" value="Save" />
                    <asp:Button ID="btnSave" Style="display: none;" runat="server" Text="Save" CssClass="btn btn-md btn-success" OnClick="btnSave_Click" />
                </td>
            </tr>
        </table>
    </div>
</asp:Content>

